select * from journal order  by `交易分类` DESC,交易时间  DESC
-- 1.更新表结构
ALTER TABLE journal 
MODIFY COLUMN 交易时间 datetime;

ALTER TABLE journal 
MODIFY COLUMN 金额 DECIMAL(10,2); 

-- 2.1更新交易分类 灵活备注字段
UPDATE journal 
SET `交易分类` = `备注` 
where `备注` in ('子女养老','宝宝','恋爱共享')


-- 2.2 更新同一个商家订单号, 交易分类相同
UPDATE journal
SET `交易分类` = CASE  
  WHEN `交易分类` = '日用百货' THEN '家居家用'
  WHEN `交易分类` = '文化休闲' THEN '休闲娱乐'
  WHEN `交易分类` = '亲友代付' THEN '亲朋社交'
  ELSE `交易分类`
END;

-- 3.1 更新投资理财收支类型为收入
UPDATE journal set `收/支`='收入' where `交易分类`='投资理财'

update journal t  
join(
	select `商家订单号`,`交易分类` from journal s 
	where s.`收/支`='支出'
	)ss ON ss.`商家订单号` = t.`商家订单号`
set t.`交易分类`=ss.`交易分类` 


	
	
select * from journal where 	`交易分类`='退款'
	
	
-- 3.2 更新同一个 `商家订单号` 只有一条记录 
select * from journal where `商家订单号` in(
	select `商家订单号`
	from journal 
	GROUP BY `商家订单号`
	having COUNT(*) > 1 
	)



select * from journal where `交易分类` = '交通出行' order by `交易时间` desc



SELECT `交易分类`,SUM(`金额`) as 总支出 from journal 
where `收/支`= '支出'
group by `交易分类` 
order by 总支出	 desc 

select 商家订单号,
sum(case when `收/支`='支出' then `金额` else 0.00 END ) as 总支出,
sum(case when `收/支`='不计收支' then `金额` else 0.00 END) as 总退款,
(sum(case when `收/支`='支出' then `金额` else 0.00 END )-sum(case when `收/支`='不计收支' then `金额` else 0.00 end)  ) as 净支出
from journal
where 1=1
GROUP BY `商家订单号`









